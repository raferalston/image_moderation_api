## üñºÔ∏è NSFW Image Moderation API (FastAPI + Sightengine)

–≠—Ç–æ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –Ω–∞–ª–∏—á–∏–µ NSFW-–∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–æ–±–Ω–∞–∂—ë–Ω–Ω–æ—Å—Ç—å, –æ—Ä—É–∂–∏–µ, –Ω–∞—Ä–∫–æ—Ç–∏–∫–∏, –Ω–∞—Å–∏–ª–∏–µ –∏ –¥—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º API —Å–µ—Ä–≤–∏—Å–∞ [Sightengine](https://sightengine.com/).

### üèóÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫:

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
git clone <URL –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è>
cd <–ø–∞–ø–∫–∞ —Å –ø—Ä–æ–µ–∫—Ç–æ–º>/app

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
python -m venv env
source env/bin/activate  # –î–ª—è Windows: env\Scripts\activate
pip install -r requirements.txt

# 3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª app/.env —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–æ—Å—Ç—É–ø–∞ *–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –Ω–∏–∂–µ:
API_USER=your_api_user_here
API_KEY=your_api_key_here

# 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è *–∏–∑ –∫–æ—Ä–Ω—è app/:
uvicorn main:app --reload

# 5. –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ñ–∞–π–ª–æ–≤ –≤ app/
–ù–∞–ø—Ä–∏–º–µ—Ä app/example.jpg

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å api
curl -X POST -F "file=@example.jpg" http://localhost:8000/moderate

```

---

### üì§ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ:

```
http://localhost:8000/docs
```

–í—ã —É–≤–∏–¥–∏—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Swagger.


### ‚úÖ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
pytest
```

–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:

* —É—Å–ø–µ—à–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è;
* –≤—ã—è–≤–ª–µ–Ω–∏–µ NSFW-–∫–æ–Ω—Ç–µ–Ω—Ç–∞;
* –æ—à–∏–±–∫—É –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–∞.

---

### üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∏:

–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –∏–ª–∏ –ø–æ—Ä–æ–≥ NSFW) –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `.env`:

```env
API_KEY=API secret –≤ [sightengine](https://dashboard.sightengine.com/api-credentials)
API_USER=API user –≤ [sightengine](https://dashboard.sightengine.com/api-credentials)
NSFW_THRESHHOLD=0.5
MODELS=...–°—Ç—Ä–æ–∫–∞ —Å –º–æ–¥–µ–ª—è–º–∏
AI_URL=—ç–Ω–¥–ø–æ–∏–Ω—Ç
```

---

### ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

* –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ POST-–∑–∞–ø—Ä–æ—Å (`multipart/form-data`).
* –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é –≤ Sightengine API.
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω–∞—Ä—É—à–∞–µ—Ç –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (NSFW, violence, drugs –∏ –ø—Ä.).
* –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

  * `{"status": "OK"}` ‚Äî –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω.
  * `{"status": "REJECTED", "reason": "NSFW content"}` ‚Äî –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞.

---

### üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:

```
app/
‚îî‚îÄ‚îÄ
   ‚îú‚îÄ‚îÄ core/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   ‚îÇ   ‚îî‚îÄ‚îÄ config.py
   ‚îú‚îÄ‚îÄ routers/           # –ú–∞—Ä—à—Ä—É—Ç—ã FastAPI
   ‚îÇ   ‚îî‚îÄ‚îÄ moderate.py
   ‚îú‚îÄ‚îÄ schemas/           # Pydantic-—Å—Ö–µ–º—ã
   ‚îÇ   ‚îî‚îÄ‚îÄ moderate.py
   ‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–º–æ–¥–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
   ‚îÇ   ‚îî‚îÄ‚îÄ moderate.py
   ‚îú‚îÄ‚îÄ tests/             # –¢–µ—Å—Ç—ã
   ‚îÇ   ‚îî‚îÄ‚îÄ test_moderate.py
   ‚îú‚îÄ‚îÄ main.py            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
   ‚îú‚îÄ‚îÄ .env               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API-–∫–ª—é—á–µ–π (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
   ‚îî‚îÄ‚îÄ requirements.txt   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ readme.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

### ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

* Python 3.10+
* Sightengine API (–Ω—É–∂–µ–Ω –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ [https://sightengine.com](https://sightengine.com))


